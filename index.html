<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <link rel="icon" href="logo2.png" type="image/png"/>
  <title>Taller de simulaci칩n - Toxicolog칤a-FCM, UNLP</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --primary: #0c8c9c;
      --primary-dark: #04545d;
      --accent: #c96d00;
      --bg-light: #f9f8f5;
      --white: #ffffff;
    }

    html, body {
      margin: 0; padding: 0; min-height: 100vh;
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(135deg, #087882 0%, #0c8c9c 40%, #045c63 70%, #04545d 100%);
      background-attachment: fixed;
    }

    main {
      background: rgba(249, 248, 245, 0.98); border-radius: 24px;
      width: 95%; max-width: 500px; padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3); margin: 20px auto;
      box-sizing: border-box;
    }

    #logo { display: block; width: 100%; height: auto; margin-bottom: 20px; border-radius: 14px; }
    h1 { text-align: center; color: var(--primary-dark); margin-bottom: 20px; font-size: 18px; font-weight: 700; text-transform: uppercase; }

    form { background: var(--white); padding: 20px; border-radius: 18px; border: 1px solid #eee; }
    label { display: block; margin-top: 15px; font-weight: 700; color: var(--primary-dark); font-size: 13px; }

    input {
      width: 100%; padding: 12px; margin-top: 6px;
      border-radius: 12px; border: 2px solid #e8e8e8;
      box-sizing: border-box; font-size: 15px;
    }

    #contenedorTurnos {
      display: grid; grid-template-columns: 1fr; gap: 8px;
      margin-top: 10px; max-height: 200px; overflow-y: auto;
      padding: 5px; border: 1px inset #eee; border-radius: 12px;
    }

    .turno-card {
      background: white; border: 2px solid #e8e8e8; padding: 12px;
      border-radius: 12px; cursor: pointer; transition: 0.2s;
      display: flex; justify-content: space-between; align-items: center; font-size: 14px;
    }
    .turno-card.selected { border-color: var(--primary); background: var(--primary); color: white; }

    button { width: 100%; padding: 15px; margin-top: 15px; border-radius: 12px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; }
    #btnSubmit { background-color: var(--primary); color: white; }

    /* MODAL DE COMPROBANTE */
    #comprobanteModal {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92);
      z-index: 200000; padding: 10px; overflow-y: auto;
      flex-direction: column; align-items: center;
    }

    /* FORMATO 16:9 VERTICAL */
    .ticket-container {
      width: 320px; height: 568px;
      background: var(--white); border-radius: 20px;
      overflow: hidden; display: flex; flex-direction: column;
      position: relative;
    }

    .ticket-header { 
      background: var(--primary); color: white; 
      padding: 20px; text-align: center;
      display: flex; flex-direction: column; align-items: center;
    }

    /* Logo dentro del ticket */
    .logo-ticket {
      width: 140px; height: auto; margin-bottom: 10px;
      filter: brightness(0) invert(1); /* Lo hace blanco para que resalte en el fondo azul */
    }

    .ticket-body { padding: 25px 20px; flex-grow: 1; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
    
    .watermark {
      position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
      font-size: 35px; font-weight: 900; color: rgba(0,0,0,0.02); white-space: nowrap; pointer-events: none;
    }

    .info-group { margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 8px; }
    .info-label { font-size: 9px; color: #888; text-transform: uppercase; }
    .info-value { font-size: 16px; font-weight: 700; color: var(--primary-dark); display: block; }

    .qr-area { display: flex; flex-direction: column; align-items: center; background: #f9f9f9; padding: 15px; border-radius: 15px; border: 1px solid #eee; }

    .btn-download { background: #2ecc71; color: white; margin-top: 20px; max-width: 320px; }
    .btn-close { background: transparent; color: white; border: 1px solid white; margin-top: 10px; max-width: 320px; }
  </style>
</head>

<body>

  <main id="mainContent">
    <img src="logo.png" alt="Logo" id="logo">
    <h1>Inscripci칩n Talleres</h1>
    
    <form id="inscripcionForm">
      <label>Nombre Completo:</label>
      <input id="nombre" name="nombre" placeholder="Apellido y Nombre" required type="text"/>
      <label>Legajo:</label>
      <input id="legajo" name="legajo" placeholder="12345/6" required type="text"/>
      <label>Correo electr칩nico:</label>
      <input id="email" name="email" placeholder="correo electr칩nico" required type="email"/>
      
      <label>Seleccione fecha:</label>
      <div id="contenedorTurnos"></div>
      
      <input type="hidden" name="turno" id="turnoInput" required>
      <input type="hidden" id="turnoTextoSeleccionado">
      
      <button type="submit" id="btnSubmit">Finalizar Registro</button>
    </form>
  </main>

  <div id="comprobanteModal">
    <div class="ticket-container" id="ticketImage">
      <div class="ticket-header">
        <img src="logo.png" class="logo-ticket" alt="Logo C치tedra">
        <div style="font-size: 9px; opacity: 0.8; letter-spacing: 1.5px; font-weight: 600;">COMPROBANTE OFICIAL</div>
      </div>
      
      <div class="ticket-body">
        <div class="watermark">SIMULACI칍N 2026</div>
        <div>
          <div class="info-group">
            <span class="info-label">游녻 Estudiante</span>
            <span class="info-value" id="comp-nombre"></span>
          </div>
          <div class="info-group">
            <span class="info-label">游 Legajo</span>
            <span class="info-value" id="comp-legajo"></span>
          </div>
          <div class="info-group" style="background: #f0fbfc; padding: 10px; border-radius: 10px; border: 1px solid #d0eef2;">
            <span class="info-label">游늰 Turno Asignado</span>
            <span class="info-value" id="comp-turno" style="color: var(--primary);"></span>
          </div>
        </div>

        <div class="qr-area">
          <div id="qrcode"></div>
          <span style="font-size: 8px; margin-top: 8px; color: #666; text-align: center;">V치lido para ingreso al taller<br>FCM - UNLP</span>
        </div>
      </div>
    </div>

    <button class="btn-download" onclick="descargarTicket()">拘勇 Guardar Imagen</button>
    <button class="btn-close" onclick="location.reload()">Cerrar</button>
  </div>

<script>
// (Aqu칤 va el mismo script de procesamiento del paso anterior)
const scriptURL = 'https://script.google.com/macros/s/AKfycbw0efPHaFlA2WSfvS2otcQpyT7QtG0M6n9erz_6v3Bag-z8yEV6tjk1ZkcU3qxUkM7GFQ/exec';
const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQl056VY6Tv-hIeNjQrcElL4zusVkjizmfO8YJLqe6IhGwk4eYY3D1SeqpUFIP9RnESYuNGsc_sn7J3/pub?gid=0&single=true&output=csv";

function cargarTurnos() {
  fetch(scriptURL + '?action=turnos').then(res => res.json()).then(data => {
    const contenedor = document.getElementById('contenedorTurnos');
    contenedor.innerHTML = '';
    data.forEach(t => { 
      if(t.disponible) {
        const card = document.createElement('div');
        card.className = 'turno-card';
        card.innerHTML = `<span>${t.texto.split(' (')[0]}</span><span style="font-size:11px; color:#888;">${t.cupos} lib.</span>`;
        card.onclick = () => {
          document.querySelectorAll('.turno-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          document.getElementById('turnoInput').value = t.id;
          document.getElementById('turnoTextoSeleccionado').value = t.texto.split(' (')[0];
        };
        contenedor.appendChild(card);
      }
    });
  });
}
cargarTurnos();

document.getElementById('inscripcionForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  if(!document.getElementById('turnoInput').value) return alert("Seleccion치 un turno");
  const b = document.getElementById('btnSubmit');
  b.disabled = true; b.textContent = 'Enviando...';

  try {
    const response = await fetch(scriptURL, { method: 'POST', body: new FormData(e.target) });
    document.getElementById('comp-nombre').textContent = document.getElementById('nombre').value.toUpperCase();
    document.getElementById('comp-legajo').textContent = document.getElementById('legajo').value;
    document.getElementById('comp-turno').textContent = document.getElementById('turnoTextoSeleccionado').value;
    
    document.getElementById("qrcode").innerHTML = "";
    new QRCode(document.getElementById("qrcode"), {
      text: "CERT: " + document.getElementById('legajo').value + " TALLER TOXICO",
      width: 100, height: 100, colorDark : "#04545d",
    });

    document.getElementById('comprobanteModal').style.display = 'flex';
    document.getElementById('mainContent').style.display = 'none';
  } catch (error) {
    alert("Error de conexi칩n.");
    b.disabled = false;
  }
});

function descargarTicket() {
  const btn = document.querySelector('.btn-download');
  btn.textContent = "Generando...";
  html2canvas(document.getElementById('ticketImage'), {
    scale: 3, useCORS: true, allowTaint: true
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = `Ticket_Toxicologia.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();
    btn.textContent = "拘勇 Guardar Imagen";
  });
}

document.getElementById('legajo').addEventListener('input', (e) => {
  let v = e.target.value.replace(/[^0-9]/g, '');
  if (v.length > 5) v = v.slice(0, 5) + '/' + v.slice(5, 6);
  e.target.value = v;
});
</script>
</body>
</html>






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































