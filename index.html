<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <link href="logo2.png" rel="icon" type="image/png"/>
  <title>Taller de simulación - Toxicología-FCM,UNLP</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background: #f9f9f9;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #38828f;
    }
    form {
      background: #f9f8f5;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    button {
      background-color: #38828f;
      color: white;
      border: none;
      margin-top: 20px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2a6a73;
    }
    #inscripcionForm button[type="submit"] {
      width: auto;
      display: block;
      padding: 10px 20px;
      margin: 20px auto 0;
    }
    #logo {
      display: block;
      margin: 0 auto 20px;
      max-width: 600px;
      width: 100%;
      height: auto;
    }
    @media (max-width: 600px) {
      #logo {
        max-width: 90%;
      }
    }
    .contacto {
      text-align: center;
      margin-top: 30px;
      color: #333;
      font-size: 14px;
    }
    #guardarBtn {
      display: none;
      background-color: #4caf50;
      width: auto;
      padding: 10px 20px;
      margin: 15px auto 0;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    #aviso-descarga {
      display: none;
      margin-top: 15px;
      font-size: 14px;
      text-align: center;
      color: #d84315;
    }
    #avisoCierre {
      color: red;
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 15px;
      text-align: center;
    }
    #popup, #popup-error, #verInscripcionModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 30px;
      border-radius: 12px;
      font-size: 18px;
      text-align: center;
      z-index: 1000;
      box-shadow: 0px 5px 25px rgba(0,0,0,0.3);
      background-color: #ffffff;
      color: black;
      font-family: 'Open Sans', sans-serif;
    }
    #popup {
      border: 2px solid #38828f;
    }
    #popup-error {
      border: 2px solid #c62828;
      color: #b71c1c;
      background-color: #ffebee;
    }
    #loader {
      display: none;
      text-align: center;
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
      color: #38828f;
    }

    /* Modal numerado */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 99999;
    }
    .modal {
      background: white;
      padding: 25px 30px;
      border-radius: 10px;
      max-width: 500px;
      text-align: left;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
    }
    .modal h2 {
      color: #e07b00;
      margin-bottom: 15px;
      text-align: center;
    }
    .modal ol {
      padding-left: 20px;
      font-size: 16px;
      line-height: 1.5;
    }
    .modal li.important {
      color: red;
      font-weight: bold;
    }
    .modal button {
      margin-top: 20px;
      display: block;
      width: 100%;
      padding: 10px 0;
      background-color: #e07b00;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    .modal button:hover {
      background-color: #c06500;
    }

    /* Botón "Ver mi inscripción" */
    #verInscripBtn {
      background-color: #38828f;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    #verInscripBtn:hover {
      background-color: #2a6a73;
    }

    /* Estilos internos del modal de ver inscripción */
    #verInscripcionModal {
      max-width: 450px;
      width: 90%;
      border: 2px solid #38828f;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      text-align: center;
      padding: 25px;
      background-color: #ffffff;
    }
    #verInscripcionModal h2 {
      text-transform: uppercase;
      font-weight: normal;
      font-family: 'Open Sans', sans-serif;
      margin-bottom: 15px;
      font-size: 20px;
    }
    #verInscripcionModal label {
      font-size: 14px;
      font-weight: normal;
      display: block;
      margin-bottom: 5px;
      text-align: left;
    }
    #verInscripcionModal input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    #verInscripcionModal button {
      background-color: #38828f;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    #verInscripcionModal button:hover {
      background-color: #2a6a73;
    }
    #resultadoBusqueda {
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      font-size: 16px;
      text-align: left;
      border: 1px solid #ccc;
    }

    /* NUEVO: bloqueo visual si formulario cerrado */
    .form-cerrado {
      background-color: #f0f0f0 !important;
      pointer-events: none;
      opacity: 0.6;
    }
  </style>
</head>
<body>

<!-- Modal numerado -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h2>⚠ ATENCIÓN</h2>
    <ol>
      <li>Solo podrá inscribirse y seleccionar una <strong>fecha por única vez</strong>.</li>
      <li>Antes de inscribirse, verifique su <strong>disponibilidad horaria</strong>.</li>
      <li class="important">Respete el orden al ingresar su nombre: Apellido y Nombre/s.</li>
    </ol>
    <button onclick="cerrarModal()">Aceptar, quiero inscribirme</button>
    <button id="verInscripBtn" onclick="abrirVerInscripcion(); cerrarModal()">Ya estoy inscripto, ver mi fecha</button>
  </div>
</div>

<img alt="Logo Cátedra Toxicología" id="logo" src="logo.png"/>
<h1>PLATAFORMA DE INSCRIPCIONES</h1>
<form id="inscripcionForm">
  <label for="nombre">Alumno:</label>
  <input id="nombre" name="nombre" placeholder="Apellido y Nombre" required type="text"/>
  <label for="legajo">Legajo:</label>
  <input id="legajo" name="legajo" placeholder="12345/6" required type="text"/>
  <label for="email">Correo electrónico:</label>
  <input id="email" name="email" placeholder="alumno@gmail.com" required type="email"/>
  <label for="turno">
    Seleccione:
    <span id="ocupacionTotal" style="font-weight:bold;"></span>
  </label>
  <select id="turno" name="turno" required>
    <option disabled selected value="">Fechas disponibles...</option>
  </select>
  <div id="avisoCierre" style="display:none;"></div>
  <button type="submit">Inscribirme</button>
</form>

<div id="loader">Inscribiendo<span id="dots"></span></div>
<div id="aviso-descarga">Descargue el comprobante de inscripción. Por favor, agende la fecha seleccionada.</div>
<button id="guardarBtn">Descargar Comprobante</button>
<canvas id="descargaCanvas" style="display:none;"></canvas>
<div id="mensaje"></div>
<div id="popup">Inscripción exitosa. Te esperamos en el Hospital de simulación en tu fecha seleccionada.</div>
<div id="popup-error">Usted ya posee una fecha reservada, no es posible realizar una nueva.</div>

<!-- Modal para ver inscripción -->
<div id="verInscripcionModal"></div>

<div class="contacto">
    © Cátedra de Toxicología, HoSiC, Facultad de Ciencias Médicas - UNLP<br/>
    <strong style="font-weight: 700;">toxicoalumnos@gmail.com</strong>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbw0efPHaFlA2WSfvS2otcQpyT7QtG0M6n9erz_6v3Bag-z8yEV6tjk1ZkcU3qxUkM7GFQ/exec';
const TOTAL_CUPOS = 140; 
let dotsInterval;

// ------------------ INTERRUPTOR DE FORMULARIO ------------------
const urlEstado = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQl056VY6Tv-hIeNjQrcElL4zusVkjizmfO8YJLqe6IhGwk4eYY3D1SeqpUFIP9RnESYuNGsc_sn7J3/pub?output=csv';

function verificarEstadoFormulario() {
  fetch(urlEstado)
    .then(res => res.text())
    .then(csvText => {
      const filas = csvText.trim().split('\n');
      let estado = 'abierto';
      if (filas.length > 1) {
        const columnas = filas[1].split(',');
        if (columnas[5]) estado = columnas[5].trim().toLowerCase();
      }
      const formulario = document.getElementById('inscripcionForm');
      const turnoSelect = document.getElementById('turno');
      const avisoCierre = document.getElementById('avisoCierre');
      if (estado === 'cerrado') {
        formulario.classList.add('form-cerrado');
        turnoSelect.style.display = 'none';
        avisoCierre.style.display = 'block';
        avisoCierre.textContent = 'Disculpe, las inscripciones están cerradas.';
      } else {
        formulario.classList.remove('form-cerrado');
        turnoSelect.style.display = 'block';
        avisoCierre.style.display = 'none';
        avisoCierre.textContent = '';
      }
    });
}

// ------------------ Actualización de turnos ------------------
function actualizarTurnos() {
  fetch(scriptURL + '?action=turnos')
    .then(res => res.json())
    .then(data => {
      const turnoSelect = document.getElementById('turno');
      turnoSelect.innerHTML = '<option value="" disabled selected>Fechas disponibles...</option>';

      let sumCuposDisponibles = 0;
      data.forEach(turno => {
        if (turno.disponible) {
          sumCuposDisponibles += Number(turno.cupos);
          const option = document.createElement('option');
          option.value = turno.id;
          option.textContent = `${turno.texto} (Cupos: ${turno.cupos})`;
          turnoSelect.appendChild(option);
        }
      });

      const ocupados = TOTAL_CUPOS - sumCuposDisponibles;
      const porcentaje = Math.round((ocupados / TOTAL_CUPOS) * 100);
      const ocupacionSpan = document.getElementById('ocupacionTotal');
      ocupacionSpan.textContent = `${porcentaje}% de ocupación`;
      if (porcentaje <= 50) ocupacionSpan.style.color = 'green';
      else if (porcentaje <= 80) ocupacionSpan.style.color = 'orange';
      else ocupacionSpan.style.color = 'red';

      // ---------- Llamada al interruptor ----------
      verificarEstadoFormulario();
    })
    .catch(() => {
      alert('Error al cargar los turnos. Intente nuevamente más tarde.');
    });
}

// ------------------ resto de tu JS original ------------------
// Todo tu JS original de inscripción, descarga, modal, búsqueda, legajo, etc.
// No se toca nada más que agregar la función de interruptor arriba y llamarla en actualizarTurnos()

document.addEventListener('DOMContentLoaded', actualizarTurnos);
</script>
</body>
</html>













































































